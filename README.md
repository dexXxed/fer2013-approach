# FER2013 
[![forthebadge made-with-python](http://ForTheBadge.com/images/badges/made-with-python.svg)](https://www.python.org/)


Конкурс Kaggle - https://www.kaggle.com/c/challenges-in-representation-learning-facial-expression-recognition-challenge/data

Распознавание эмоций в наборе данных FER2013 с использованием сверточной нейронной сети (CNN).

Победитель - 71.161 % точности

Эта модель -  66.369 % точности

![emotions](https://user-images.githubusercontent.com/28602282/48102098-ab737b80-e1e6-11e8-8541-517de2be0064.png)

## Начнём

Эти инструкции помогут запустить эту модель. Следуйте им, чтобы использовать скрипт `fertestcusstom.py` для распознавания эмоций на пользовательских изображениях.

### Установка зависимостей

Тут используется `Python 3.7.7`, установка зависимостей происходит с помощью команды:
```
 pip install -r requirements.txt
```
(желательно использование `virtualenv`)

### Метод 1 : Использование готовой модели

Если Вы не хотите обучать классификатор с нуля, вы можете использовать `fertestcustom.py` напрямую, так как в репозитории уже есть` fer.json` (обученная модель) и `fer.h5` (параметры), которые может использоваться для прогнозирования эмоций на любом тестовом изображении, присутствующем в папке.

### Метод 2 : Build исходников

Склоньте этот репозиторий себе

```
git clone https://github.com/dexXxed/fer2013-approach.git
```

Запустите файл `preprocessing.py`, который сгенерирует файлы `fadataX.npy` и `flabels.npy`.

Запустите файл `fertrain.py`, это может занять некоторое время, в зависимости от вашего процессора и GPU. Потребовалось около 30 минут для обучения модели в Google Colab (GPU-mode). Этот скрипт создаст для Вас файлы `modXtest.npy`,` modytest, npy`, `fer.json` и` fer.h5`.

## Запускаем тесты (Опционально)

Вы можете проверить точность обученной модели, используя `modXtest.npy` и` modytest.npy`, запустив файл `fertest.py`. Это даст Вам точность в % от недавно обученной модели.

## Получение матрицы несоответствий (Опционально)

Вы можете получить матрицу несоответствий для этой модели, запустив файл `confmatrix.py`. Это позволит оценить самые запутанные эмоции и сгенерировать файл `confusionmatrix.png` для Вашей обученной модели, который будет выглядеть примерно так.

![confusionmatrix](https://user-images.githubusercontent.com/28602282/47956084-d8186080-df64-11e8-9d07-c7eda5cf6697.png)

# Структура модели

Слои в свёрточной нейронной сети, используемые при реализации этого классификатора, можно показать следующим образом. 

![layers](https://user-images.githubusercontent.com/28602282/48034278-f5435f80-e11b-11e8-8390-585e34fc18ae.png)

Вы можете получить похожую сводку, вызовом функции `model.summary()` в файле `fertrain.py`.
